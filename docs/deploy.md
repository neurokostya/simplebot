# Развертывание бота на Ubuntu сервере

## Подготовка сервера

1. Обновите пакеты:
```bash
sudo apt update && sudo apt upgrade -y
```

2. Установите необходимые пакеты:
```bash
sudo apt install -y docker.io docker-compose git
```

3. Добавьте вашего пользователя в группу docker:
```bash
sudo usermod -aG docker $USER
```

4. Перезагрузите группы (или перезайдите в систему):
```bash
newgrp docker
```

## Клонирование и настройка проекта

1. Клонируйте репозиторий:
```bash
git clone https://github.com/your-username/simplebot.git
cd simplebot
```

2. Создайте файл с переменными окружения:
```bash
nano .env
```

3. Добавьте в файл `.env` токен вашего бота:
```
BOT_TOKEN=your_bot_token_here
```

## Запуск бота

1. Соберите и запустите контейнеры в фоновом режиме:
```bash
docker-compose up -d
```

2. Проверьте статус контейнера:
```bash
docker-compose ps
```

3. Посмотреть логи можно командой:
```bash
docker-compose logs -f
```

## Управление ботом

### Остановка бота
```bash
docker-compose down
```

### Перезапуск бота
```bash
docker-compose restart
```

### Обновление бота

1. Остановите текущую версию:
```bash
docker-compose down
```

2. Получите последние изменения:
```bash
git pull
```

3. Пересоберите и запустите контейнеры:
```bash
docker-compose up -d --build
```

## Автозапуск при перезагрузке сервера

1. Включите автозапуск Docker:
```bash
sudo systemctl enable docker
```

2. Проверьте статус:
```bash
sudo systemctl status docker
```

## Мониторинг

### Просмотр использования ресурсов
```bash
docker stats
```

### Проверка логов
```bash
# Последние 100 строк логов
docker-compose logs --tail=100

# Логи в реальном времени
docker-compose logs -f
```

## Решение проблем

### Если бот не запускается
1. Проверьте логи:
```bash
docker-compose logs
```

2. Проверьте статус контейнера:
```bash
docker-compose ps
```

3. Проверьте наличие и правильность файла .env:
```bash
ls -la .env
```

### Если контейнер падает
1. Проверьте свободное место на диске:
```bash
df -h
```

2. Проверьте использование памяти:
```bash
free -h
```

## Полезные команды для обслуживания

### Очистка неиспользуемых Docker ресурсов
```bash
# Очистка неиспользуемых контейнеров, сетей и образов
docker system prune -a

# Очистка только неиспользуемых образов
docker image prune
```

### Бэкап данных
```bash
# Создание резервной копии poems.json
cp poems.json poems.json.backup
```

## Деплой на Timeweb Cloud

### Особенности и ограничения Timeweb Cloud
1. Не поддерживается использование volumes в docker-compose.yml
2. Для деплоя используется специальная версия конфигурации: `docker-compose.timeweb.yml`

### Подготовка к деплою на Timeweb Cloud

1. Убедитесь, что в репозитории есть файл `docker-compose.timeweb.yml` без использования volumes
2. Данные из `poems.json` должны быть включены в образ Docker при сборке

### Процесс деплоя

1. В панели управления Timeweb Cloud создайте новый Docker-контейнер
2. Выберите опцию деплоя из репозитория GitHub
3. Укажите ветку для деплоя (обычно `main` или `master`)
4. В настройках переменных окружения добавьте:
   ```
   BOT_TOKEN=your_bot_token_here
   ```
5. В настройках автодеплоя укажите файл `docker-compose.timeweb.yml`

### Мониторинг на Timeweb Cloud

1. Логи контейнера доступны в разделе "Логи" панели управления
2. Статус контейнера и использование ресурсов можно отслеживать в разделе "Мониторинг"

### Решение проблем на Timeweb Cloud

1. Если видите ошибку про volumes:
   - Убедитесь, что используется `docker-compose.timeweb.yml`
   - Проверьте, что в файле нет секции `volumes`

2. Если контейнер не запускается:
   - Проверьте логи в панели управления
   - Убедитесь, что все переменные окружения установлены корректно
   - Проверьте, что Dockerfile корректно копирует все необходимые файлы 